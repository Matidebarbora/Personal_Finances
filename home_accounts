import csv
import cowsay
from tabulate import tabulate


def add_column(csv_file):
    script = csv_to_list(csv_file)
    col_name = input("Insert new column's name: ")
    col_index = int(input("New column's position: "))
    script[0].insert(col_index, col_name)
    for line in script[1:]:
         line.insert(col_index, "0")

    with open(csv_file, "w", newline="") as file:
        writer = csv.writer(file)
        writer.writerows(script)

    print("")
    print("Column added!")
    print("")


def del_column(csv_file):
    script = csv_to_list(csv_file)
    col_name = input("Name of the column to delete: ")
    if col_name in script[0]:
        col_index = script[0].index(col_name)
        for col in script:
            col.pop(col_index)

        with open(csv_file, "w", newline="") as file:
            writer = csv.writer(file)
            writer.writerows(script)

        print("")
        print("Column deleted!")
        print("")
    else:
        print("The column doesn't exist")


def csv_to_list(csv_file):
    script = []
    with open(csv_file, "r") as file:
        reader = csv.reader(file)
        for row in reader:
            script.append(row)
        return script


def print_csv(script):
        return tabulate(script, headers='firstrow', tablefmt="fancy_outline")


def insert_payment(csv_file):
    month = ((input("Month: ")).lower()).capitalize()
    acc = ((input("Account: ")).lower()).capitalize()
    value = input("Payment_value: ")
    script = csv_to_list(csv_file)
    acc_index = script[0].index(acc)

    for line in script:
         if line[0] == month:
              line[acc_index] = value

    with open(csv_file, "w", newline="") as file:
        writer = csv.writer(file)
        writer.writerows(script)

    print("")
    print("Value modified!")
    print("")


def total_sum(csv_file):
     script = csv_to_list(csv_file)
     row_length = len(script[0])

     for line in script[1:]:
          line[row_length - 1] = sum(float(value) for value in line[1:(row_length - 1)])

     with open(csv_file, "w", newline="") as file:
        writer = csv.writer(file)
        writer.writerows(script)


def main_menu():
    csv_file = "home_accounts.csv"
    total_sum(csv_file)

    print("--------------------")
    print("Options:")
    print("1) Main table")
    print("2) Insert/modify payment")
    print("3) Add column")
    print("4) Delete column")
    print("0) Exit")
    print("--------------------")

    while True:
            option = input("Select an option: ")
            if option == "1":
                print("")
                print(print_csv(csv_to_list(csv_file)))
                print("")
                print("Options: 2- Insert/modify payment | 3- Add column | 4- Delete column | 0- Exit")
                print("")
            elif option == "2":
                 insert_payment(csv_file)
                 total_sum(csv_file)
            elif option == "3":
                 add_column(csv_file)
            elif option == "4":
                 del_column(csv_file)
                 total_sum(csv_file)
            elif option == "0":
                 cowsay.cow("Goodbye!")
                 break
            else:
                 print("Invalid option")
                 pass


main_menu()

